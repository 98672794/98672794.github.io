<html>


<head>

  <title>AKi Web3</title>
  
  <!-- ============ Login  MetaMask ============ -->
  <script src="web3.min.js"></script>




  <!-- ============ 监听输入事件 即時內容另一個 ============ -->
  <script type="text/javascript" src="https://cdn.bootc0000000ss.com/jquery/1.12.4/jquery.min.js"></script>
  
  <!-- ============ html 靜態 Copy dd Js ============ -->
  <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
</head>
<body>


  














































  <div>
    <!-- ============ Login  MetaMask ============ -->
    
    <p id='userWallet'>0x00x0
      <!-- ============ MetaMask add display ============ -->
    </p>

    <a id='loginButton' onclick="" title="使用 MetaMask 登錄">
      <!-- ============ Login  MetaMask btn ============ -->
      <img src="https://mir-s3-cdn-cf.behance.net/projects/404/eb5c0f131767869.Y3JvcCwxMDI0LDgwMCwwLDExMQ.png" 
      width="50em"/>使用 MetaMask 登錄
    </a>
  
    <script>
      window.userWalletAddress = null
      const loginButton = document.getElementById('loginButton')
      const userWallet = document.getElementById('userWallet')
  
      function toggleButton() {
        if (!window.ethereum) {
          loginButton.innerText = 'MetaMask is not installed'
          return false
        }
  
        loginButton.addEventListener('click', loginWithMetaMask)
      }
  
      async function loginWithMetaMask() {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' })
          .catch((e) => {
            console.error(e.message)
            return
          })
        if (!accounts) { return }
  
        window.userWalletAddress = accounts[0]
        userWallet.innerText = window.userWalletAddress
        loginButton.innerText = '退出 MetaMask'
        //<!-- ============ html 靜態 Copy dd Js Aki ============ -->
        var str = $( "#我的錢包" ).text(accounts[0]);
        //$( "#我的錢包" ).html( str );
        //<!-- ============ / https://jsfiddle.net/mokaki/yu0n2r7z/1/ ============ -->


  
        loginButton.removeEventListener('click', loginWithMetaMask)
        setTimeout(() => {
          loginButton.addEventListener('click', signOutOfMetaMask)
        }, 200)
      }
  
      function signOutOfMetaMask() {
        window.userWalletAddress = null
        userWallet.innerText = ''
        loginButton.innerText = '使用 MetaMask 登錄'
        //<!-- ============ html 靜態 Copy dd Js Aki ============ -->
        var str = $( "#我的錢包" ).text("未登錄");
        //<!-- ============ / https://jsfiddle.net/mokaki/yu0n2r7z/1/ ============ -->

        loginButton.removeEventListener('click', signOutOfMetaMask)
        setTimeout(() => {
          loginButton.addEventListener('click', loginWithMetaMask)
        }, 200)
      }
  
      window.addEventListener('DOMContentLoaded', () => {
        toggleButton()
      });
    </script>

  <!-- ============ /Login  MetaMask ============ -->
  </div>
  <hr style=" width: 100%; height: 1px;"/>
































































  <div>
    <!-- ============ 獲取 ERC20 代幣餘額 ============ -->
    <h1>Something capability - 獲取 ERC20 代幣餘額</h1>
    <p>需要以太坊支持瀏覽器或 MetaMask</p>

    <h2>Token Address</h2>
    <input type="text" id="token-address" size="80" oninput="onAddressChange()"></input>
    <p>e.g. 0x433f874871dc4b64c27dafede0638a744f7fc47b</p>

    <h2>Wallet Address</h2>
    <input type="text" id="wallet-address" size="80" oninput="onAddressChange()"></input>
    <p>我的錢包. <samp id="我的錢包" >0x0<!-- ============ 0x79D03aE2c70952474F5878EE930aEf25c77A5B7C ============ --></samp> </p>

    <h2>餘額</h2>
    <span id="result"><!-- ============ ERC20 代幣餘額 display ============ --></span>


    <script>

      var web3js;

      function getERC20TokenBalance(tokenAddress, walletAddress, callback) {
        let minABI = [
          {"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},
          {"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"type":"function"}
        ];
        let contract = new web3js.eth.Contract(minABI, tokenAddress);
        contract.methods.balanceOf(walletAddress).call((error, balance) => {
          contract.methods.decimals().call((error, decimals) => {
            console.log(balance);
            console.log(decimals);
            balance = balance / (10**decimals);
            callback(balance);
          });
        });
      }

      function onAddressChange(e) {
        let tokenAddress = document.getElementById('token-address').value;
        let walletAddress = document.getElementById('wallet-address').value;
        if(tokenAddress != "" && walletAddress != "") {
          getERC20TokenBalance(tokenAddress, walletAddress, (balance) => {
            document.getElementById('result').innerText = balance.toString();
          });        
        }
      }

      window.onload = function() {
        web3js = new Web3(Web3.givenProvider);
        console.log(web3js.version);
      }

    </script>

  <!-- ============ /獲取 ERC20 代幣餘額 ============ -->
  </div>
  <hr style=" width: 100%; height: 1px;"/>







  <div>
    <!-- ============ 监听000000000000输入事件 即時內容另一個 ============ -->
    <script>
      //https://www.cnblogs.com/baiyangyuanzi/p/6856598.html
      //入
      $('#userWallet').on('input propertychange',function(){
          var val = $(this).val()
          //出
          $('#wallet-address').val(val)
      })
    </script>





  <script>
    //<!-- ============ html 靜態 Copy dd Js ============ -->
    //var str = $( "#userWall  e   t" ).text();
    //$( "#我的錢包" ).html( str );
  </script>


  </div>
  <hr style=" width: 100%; height: 1px;"/>








  <!-- ============ 筆記工具 ============ -->
  <div>
    筆記工具

    https://www.youtube.com/watch?v=Pnq3SRS8LsM



</div>
<hr style=" width: 100%; height: 1px;"/>





</body>
</html>